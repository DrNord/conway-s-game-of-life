/*!
Copyright (C) 2021 Dr. Nord
*/
let r=new function(e){var t=this;t.dt=e,t.prev=0,t.now=0,t.host_is_ready=!1,t.timer_handle=null,t.start=o,t.proceed=i,t.tick=n,t.stop=s,t.triggerHost=a}(1e3);self.name;function s(){null!=this.timer_handle&&(clearTimeout(this.timer_handle),this.timer_handle=null)}function o(){var e=performance.now();let t=this;t.stop(),t.prev=e,t.triggerHost(t.prev),t.timer_handle=setTimeout(()=>t.tick(),t.dt)}function i(){var e=performance.now();let t=this;t.stop(),t.dt<e-t.now?(t.triggerHost(t.prev),t.timer_handle=setTimeout(()=>t.tick(),t.dt),t.now=e,t.prev=e):t.timer_handle=setTimeout(()=>t.tick(),t.now+t.dt-e)}function n(){var e=performance.now();this.triggerHost(e);let t=this;t.now=e;e=t.now-(t.prev+t.dt);t.timer_handle=setTimeout(()=>t.tick(),t.dt-e),t.prev+=t.dt}function a(e){this.host_is_ready&&(postMessage({now:e}),this.host_is_ready=!1)}self.onmessage=e=>{var t=e.data;if("number"==typeof t.dt_ms&&(r.dt=t.dt_ms,r.timer_handle&&r.proceed()),void 0!==t.cmd)switch(t.cmd){case"act":r.triggerHost(performance.now());break;case"ready":r.host_is_ready=!0;break;case"start":r.start();break;case"stop":r.stop();break;case"set_dt":break;default:console.log("Worker-engine: the command '"+t.cmd+"' is not supported.")}};